<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Parampool Tutorial">
<meta name="keywords" content="Matplotlib plotting,Bokeh plotting,mpld3 plotting,highcharts,subpool,data item">

<title>Parampool Tutorial</title>

<!-- Bootstrap style: bootstrap_bluegray -->
<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_bootstrap/css/bootstrap_bluegray.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}

/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px;      /* fixed header height for style bootstrap_bluegray */
  margin:-50px 0 0; /* negative fixed header height */
}
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Table of contents',
               1,
               'table_of_contents',
               'table_of_contents'),
              ('Simulation program used as sample app', 1, None, '___sec0'),
              ('User interfaces for Python functions',
               1,
               'pp:GUI4functions',
               'pp:GUI4functions'),
              ('Real numbers as input and output',
               2,
               'pp:real:inout',
               'pp:real:inout'),
              ('Flask interface', 3, None, '___sec3'),
              ('Django interface', 3, None, '___sec4'),
              ('A plot as output', 2, 'pp:plot:output', 'pp:plot:output'),
              ('Flask application', 3, None, '___sec6'),
              ('Django application', 3, None, '___sec7'),
              ('Comparing graphs in the same plot', 3, None, '___sec8'),
              ('Bokeh plotting', 3, None, '___sec9'),
              ('mpld3 plotting', 3, None, '___sec10'),
              ('Pandas highcharts plotting', 3, None, '___sec11'),
              ('More input parameters and results',
               2,
               'pp:flask4',
               'pp:flask4'),
              ('The returned HTML code', 3, None, '___sec13'),
              ('Documentation of the application', 3, None, '___sec14'),
              ('Django interface', 3, None, '___sec15'),
              ('Other types of input data', 2, None, '___sec16'),
              ('Uploading a file', 3, None, '___sec17'),
              ('Working with a pool of input parameters',
               1,
               'pp:flask_pool1',
               'pp:flask_pool1'),
              ('Specifying a pool as a list',
               2,
               'pp:flask_pool1:list',
               'pp:flask_pool1:list'),
              ('Attributes in data items',
               2,
               'pp:flask_pool1:dataitem',
               'pp:flask_pool1:dataitem'),
              ('The compute function',
               2,
               'pp:flask_pool1:compute',
               'pp:flask_pool1:compute'),
              ('A command-line and file interface',
               2,
               'pp:flask_pool1:cml_file',
               'pp:flask_pool1:cml_file'),
              ('A web-based user interface',
               2,
               'pp:flask_pool1:GUI',
               'pp:flask_pool1:GUI'),
              ('Operating the graphical web interface',
               2,
               'pp:flask_pool1:GUI_op',
               'pp:flask_pool1:GUI_op'),
              ('Detection of wrong input',
               2,
               'pp:flask_pool1:GUI_error',
               'pp:flask_pool1:GUI_error'),
              ('Loading parameters from file and the command line',
               2,
               'pp:flask_pool1:GUI_cml_file',
               'pp:flask_pool1:GUI_cml_file'),
              ("Common trouble: ``Address already in use''",
               2,
               None,
               '___sec27'),
              ('Specifying a pool using an API', 2, None, '___sec28'),
              ('Specifying a pool using an alternative API',
               2,
               None,
               '___sec29'),
              ('File with documentation of the application',
               3,
               None,
               '___sec30'),
              ('LaTeX symbol as parameter name', 3, None, '___sec31'),
              ('Multiple input values for parameters', 3, None, '___sec32'),
              ('Login and archival of results', 2, None, '___sec33'),
              ('Problems with sending email', 3, None, '___sec34'),
              ('Python expressions as input', 2, None, '___sec35'),
              ('Exercises', 1, None, '___sec36'),
              ('Exercise 1: Make a web app for integration',
               2,
               'pp:exer:integrate',
               'pp:exer:integrate'),
              ('Exercise 2: Make a web app for plotting data',
               2,
               'pp:exer:plotdata',
               'pp:exer:plotdata'),
              ('Exercise 3: Make a web app for studying vibrations',
               2,
               None,
               '___sec39'),
              ('Problem 4: Make a coin flipper', 2, None, '___sec40'),
              ('Exercise 5: Make a web app for the Lorenz system',
               2,
               'pp:exer:lorenz',
               'pp:exer:lorenz'),
              ('Exercise 6: Customize an automatically generated web app',
               2,
               'pp:exer:custom1',
               'pp:exer:custom1'),
              ('Deployment', 1, None, '___sec43'),
              ('Wakari', 2, None, '___sec44'),
              ('Local server', 2, None, '___sec45'),
              ('Bibliography', 1, None, '___sec46'),
              ('Appendix: Installation of Parampool', 1, None, '___sec47')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="pp.html">Parampool Tutorial</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._pp001.html#table_of_contents" style="font-size: 80%;"><b>Table of contents</b></a></li>
     <!-- navigation toc: --> <li><a href="._pp002.html#___sec0" style="font-size: 80%;"><b>Simulation program used as sample app</b></a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#pp:GUI4functions" style="font-size: 80%;"><b>User interfaces for Python functions</b></a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#pp:real:inout" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Real numbers as input and output</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec3" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flask interface</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec4" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Django interface</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#pp:plot:output" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;A plot as output</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec6" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Flask application</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec7" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Django application</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec8" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comparing graphs in the same plot</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec9" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bokeh plotting</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec10" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mpld3 plotting</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec11" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pandas highcharts plotting</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#pp:flask4" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;More input parameters and results</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec13" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The returned HTML code</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec14" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Documentation of the application</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec15" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Django interface</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec16" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Other types of input data</a></li>
     <!-- navigation toc: --> <li><a href="._pp003.html#___sec17" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Uploading a file</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1" style="font-size: 80%;"><b>Working with a pool of input parameters</b></a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:list" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Specifying a pool as a list</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:dataitem" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Attributes in data items</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:compute" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;The compute function</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:cml_file" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;A command-line and file interface</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:GUI" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;A web-based user interface</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:GUI_op" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Operating the graphical web interface</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:GUI_error" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Detection of wrong input</a></li>
     <!-- navigation toc: --> <li><a href="#pp:flask_pool1:GUI_cml_file" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Loading parameters from file and the command line</a></li>
     <!-- navigation toc: --> <li><a href="#___sec27" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Common trouble: ``Address already in use''</a></li>
     <!-- navigation toc: --> <li><a href="#___sec28" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Specifying a pool using an API</a></li>
     <!-- navigation toc: --> <li><a href="#___sec29" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Specifying a pool using an alternative API</a></li>
     <!-- navigation toc: --> <li><a href="#___sec30" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File with documentation of the application</a></li>
     <!-- navigation toc: --> <li><a href="#___sec31" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LaTeX symbol as parameter name</a></li>
     <!-- navigation toc: --> <li><a href="#___sec32" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Multiple input values for parameters</a></li>
     <!-- navigation toc: --> <li><a href="._pp005.html#___sec33" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Login and archival of results</a></li>
     <!-- navigation toc: --> <li><a href="._pp005.html#___sec34" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Problems with sending email</a></li>
     <!-- navigation toc: --> <li><a href="._pp005.html#___sec35" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Python expressions as input</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec36" style="font-size: 80%;"><b>Exercises</b></a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#pp:exer:integrate" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 1: Make a web app for integration</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#pp:exer:plotdata" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 2: Make a web app for plotting data</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec39" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 3: Make a web app for studying vibrations</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec40" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Problem 4: Make a coin flipper</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#pp:exer:lorenz" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 5: Make a web app for the Lorenz system</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#pp:exer:custom1" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Exercise 6: Customize an automatically generated web app</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec43" style="font-size: 80%;"><b>Deployment</b></a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec44" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Wakari</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec45" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Local server</a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec46" style="font-size: 80%;"><b>Bibliography</b></a></li>
     <!-- navigation toc: --> <li><a href="._pp006.html#___sec47" style="font-size: 80%;"><b>Appendix: Installation of Parampool</b></a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0004"></a>
<!-- !split -->

<h1 id="pp:flask_pool1" class="anchor">Working with a pool of input parameters</h1>

<p>
Parampool's main focus is on scientific applications with lots of
input data of different type, organized in a hierarchical tree fashion.
The various input parameters are defined in terms of a <em>pool</em>.
The pool can be defined as a nested list or through a function
application programming interface (known as an API, and here
consisting of calls functionality in the <code>parampool.pool</code> package).

<p>
To exemplify the use of pools, we apply the
<code>compute_motion_and_forces</code> function (from
the section <a href="._pp003.html#pp:flask4">More input parameters and results</a>):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute_motion_and_forces0</span>(
    initial_velocity<span style="color: #666666">=5.0</span>,
    initial_angle<span style="color: #666666">=45.0</span>,
    spinrate<span style="color: #666666">=50.0</span>,
    w<span style="color: #666666">=0.0</span>,
    m<span style="color: #666666">=0.1</span>,
    R<span style="color: #666666">=0.11</span>,
    method<span style="color: #666666">=</span><span style="color: #BA2121">&#39;RK4&#39;</span>,
    dt<span style="color: #666666">=</span><span style="color: #008000">None</span>,
    plot_simplified_motion<span style="color: #666666">=</span><span style="color: #008000">True</span>,
    new_plot<span style="color: #666666">=</span><span style="color: #008000">True</span>
    ):
</pre></div>
<p>
Let us organize the 10 input parameters into four subpools. At the top
level we need a subpool, usually called "Main pool" or named after
the application. Each subpool
is here specified with a logical name of each parameter and the
corresponding variable name in the compute function:

<ul>
 <li> Main pool</li>

<ul>
   <li> Initial motion data</li>

<ul>
     <li> Initial velocity: <code>initial_velocity</code></li>
     <li> Initial angle: <code>initial_angle</code></li>
     <li> Spinrate: <code>spinrate</code></li>
</ul>

   <li> Body and environment data</li>

<ul>
     <li> Wind velocity: <code>w</code></li>
     <li> Mass: <code>m</code></li>
     <li> Radius: <code>R</code></li>
</ul>

   <li> Numerical parameters</li>

<ul>
     <li> Method: <code>method</code></li>
     <li> Time step: <code>dt</code></li>
</ul>

   <li> Plot parameters</li>

<ul>
     <li> Plot simplified motion: <code>plot_simplified_motion</code></li>
     <li> New plot: <code>new_plot</code></li>
</ul>

</ul>

</ul>

With a pool we can give the parameters more readable logical names (not
restricted to a valid variable name in Python), but we can also
specify a lot other properties too, as will be explained.

<p>
<div class="alert alert-block alert-danger alert-text-normal"><b>Parameter names must be unique!</b>
The generated Flask or Django code has a class (in <code>model.py</code> or
<code>models.py</code> for Flask and Django, respectively) where each parameter name
is transformed to a static class variable. Such code requires each
parameter to have a unique name. (Using variable names that merge the
parameter name with its subpool path would solve this problem.)
</div>


<p>
A pool is a hierarchical <em>tree structure</em> with <em>subpools</em> and
<em>data items</em>, where each data item describes an input parameter
in the problem. The task now is to make a Python specification of
the of subpools and data items in the pool tree.

<h2 id="pp:flask_pool1:list" class="anchor">Specifying a pool as a list</h2>

<p>
The pool tree can be specified as a list of lists, strings, and dictionaries.
Each list represents a subpool, each string the name of the subpool,
and each dict is a data item. The pool must be return from some
function, hereafter called the <em>pool function</em>. In our case, the
pool function goes as follows:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">pool_definition_list</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Create and return pool defined through a nested list.&quot;&quot;&quot;</span>
    pool <span style="color: #666666">=</span> [
        <span style="color: #BA2121">&#39;Main&#39;</span>, [
            <span style="color: #BA2121">&#39;Initial motion data&#39;</span>, [
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial velocity&#39;</span>, default<span style="color: #666666">=5.0</span>),
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial angle&#39;</span>, default<span style="color: #666666">=45</span>,
                     widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;range&#39;</span>, minmax<span style="color: #666666">=</span>[<span style="color: #666666">0</span>,<span style="color: #666666">90</span>], range_step<span style="color: #666666">=1</span>),
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">r&#39;Spinrate&#39;</span>, default<span style="color: #666666">=50</span>, widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>,
                     unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;1/s&#39;</span>),
                ],
            <span style="color: #BA2121">&#39;Body and environment data&#39;</span>, [
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Wind velocity&#39;</span>, default<span style="color: #666666">=0.0</span>,
                     help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Wind velocity in positive x direction.&#39;</span>,
                     minmax<span style="color: #666666">=</span>[<span style="color: #666666">-50</span>, <span style="color: #666666">50</span>], number_step<span style="color: #666666">=0.5</span>,
                     widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>, str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>),
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Mass&#39;</span>, default<span style="color: #666666">=0.1</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;kg&#39;</span>,
                     validate<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> data_item, value: value <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>,
                     help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Mass of body.&#39;</span>),
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Radius&#39;</span>, default<span style="color: #666666">=0.11</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;m&#39;</span>,
                     help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Radius of spherical body.&#39;</span>),
                ],
            <span style="color: #BA2121">&#39;Numerical parameters&#39;</span>, [
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Method&#39;</span>, default<span style="color: #666666">=</span><span style="color: #BA2121">&#39;RK4&#39;</span>,
                     widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;select&#39;</span>,
                     options<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;RK4&#39;</span>, <span style="color: #BA2121">&#39;RK2&#39;</span>, <span style="color: #BA2121">&#39;ForwardEuler&#39;</span>],
                     help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Numerical solution method.&#39;</span>),
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Time step&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">None</span>,
                     widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;textline&#39;</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;s&#39;</span>),
                ],
            <span style="color: #BA2121">&#39;Plot parameters&#39;</span>, [
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Plot simplified motion&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">True</span>,
                     help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Plot motion without drag+lift forces.&#39;</span>),
                <span style="color: #008000">dict</span>(name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;New plot&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">True</span>,
                     help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Erase all old curves.&#39;</span>),
                ],
            ],
        ]
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.UI</span> <span style="color: #008000; font-weight: bold">import</span> listtree2Pool
    pool <span style="color: #666666">=</span> listtree2Pool(pool)
    <span style="color: #008000; font-weight: bold">return</span> pool
</pre></div>
<p>
Actually, the pool function must return a <code>parampool.pool.Pool</code> object,
so after the definition of the pool tree as a list we must make the
shown conversion from a list to a <code>Pool</code> object via the <code>listtree2Pool</code>
function.

<h2 id="pp:flask_pool1:dataitem" class="anchor">Attributes in data items</h2>

<p>
Each data item has a name and preferably a default value, as in the
case of &quot;Initial velocity&quot;. More attributes can be added:

<ul>
 <li> <code>widget</code> specifies the type of widget used in a graphical
   user interface. Legal values are <code>integer</code>, <code>float</code>, <code>range</code>
   (requires the <code>minmax</code> attribute too), <code>integer_range</code> (requires
   the <code>minmax</code> attribute too), <code>textline</code>, <code>textarea</code> (for larger
   multi-line texts), <code>checkbox</code> (for boolen variables), <code>select</code>
   (list of options), <code>email</code>, <code>password</code>, <code>file</code> (for a filename
   of a file to be uploaded, <code>url</code>, <code>hidden</code> (for an invisible field),
   and <code>tel</code> (for a phone number). If not given, <code>widget</code> is based
   on the value of the <code>str2type</code> attribute or the type of the default value.</li>
 <li> <code>minmax</code> is a 2-list or 2-tuple with lower and upper bound in
   the interval of legal values of a number.</li>
 <li> The <code>range_steps</code> attribute, valid when <code>widget</code> is <code>range</code>,  specifies the
   steps in the slider used to select the number.
   In our example,
   we can select the &quot;Initial angle&quot; in unit steps between 0 and 90
   degrees.</li>
 <li> <code>unit</code> specifies a unit, e.g., <code>1/s</code> or <code>kg/m**3</code>.
   If the input contains another unit, e.g., <code>4 1/h</code>, the value will
   be automatically converted to the registered unit (\( 4/3600 \) 1/s
   if 1/s is the registered unit).
   (Parampool applies the the <code>PhysicalQuantity</code> object from the
   ScientificPython package to perform computations with units.
   A copy of this object is bundled with Parampool.)</li>
 <li> <code>help</code> adds a help string to explain more about the parameter and
   how it can be set.</li>
 <li> <code>number_step</code> specifies the precision of <code>float</code> or <code>integer</code>
   widgets if <code>minmax</code> is also specified (default 0.001), otherwise
   the precision is arbitrary.</li>
 <li> <code>str2type</code> is a conversion function from a string (text given in
   a user interface) to the right type for the parameter. A value
   of <code>str2typ2</code> is automatically assigned if <code>widget</code> is given, otherwise
   Parampool applies the default value to find the right <code>str2type</code> function.
   This means that it is strictly not necessary to assign <code>str2type</code> for the
   &quot;Wind velocity&quot; data item since the default value <code>0.0</code> implies
   <code>str2type=float</code>. With more complicated objects one can
   assign a user-given conversion function to <code>str2type</code> (shown later).</li>
 <li> <code>option</code> is a list of options for a <code>select</code> widget. The &quot;Method&quot;
   data item (for the name of the numerical solution method)
   provides an example of this widget type.</li>
 <li> <code>validate</code> holds a function that takes the value of the data item
   as argument and returns <code>True</code> or <code>False</code> depending on whether
   the value can be accepted or not.</li>
 <li> <code>symbol</code> contains a mathematical LaTeX symbol that will be used
   in Flask or Django interfaces instead of the name of data item.</li>
 <li> <code>widget_size</code> specifies the size (width) of fields in graphical
   user interfaces.</li>
 <li> The <code>textline</code> widget must be used for default values that are <code>None</code>,
   because another value or the text <code>None</code> can be written in
   the field. In this case, <code>str2type</code> is automatically set to <code>eval</code>
   and any valid Python expression is then essentially allowable,
   but wrong object types may give errors in the compute function.</li>
</ul>

<div class="alert alert-block alert-success alert-text-normal"><b>Check that default values are real numbers.</b>
If a default value is set to <code>5</code>, Parampool will interpret this as an
integer and let <code>string2type</code> be <code>int</code> and force all input to be
converted to integers. Normally, you want input to be real, so check
that the default value is <code>5.0</code> unless the pool item is really meant to be
an integer.
</div>


<h2 id="pp:flask_pool1:compute" class="anchor">The compute function</h2>

<p>
When working with pools, the compute function is allowed to take <em>only
one argument</em> called <code>pool</code>. This object is used to extract
input data. Basically, the value of any data item <code>my parameter</code>
in the pool is extracted by

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>variable <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;my parameter&#39;</span>)
</pre></div>
<p>
In case multiple data items have the same name, a sufficient part
of the subpool path must be given, e.g.,

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>variable <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;My Subpool1/my parameter&#39;</span>)
</pre></div>
<p>
Our specific compute function is a wrapper for <code>compute_motion_and_forces</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute_motion_and_forces_with_pool</span>(pool):
    initial_velocity <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Initial velocity&#39;</span>)
    initial_angle <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Initial angle&#39;</span>)
    spinrate <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Spinrate&#39;</span>)
    w <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Wind velocity&#39;</span>)
    m <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Mass&#39;</span>)
    R <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Radius&#39;</span>)
    method <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Method&#39;</span>)
    dt <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Time step&#39;</span>)
    plot_simplified_motion <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Plot simplified motion&#39;</span>)
    new_plot <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;New plot&#39;</span>)
    <span style="color: #008000; font-weight: bold">return</span> compute_motion_and_forces(
        initial_velocity, initial_angle, spinrate, w,
        m, R, method, dt, plot_simplified_motion,
        new_plot)
</pre></div>
<p>
The assumption is that the pool object provides enough input data for
the compute function. If this assumption does not hold and extra
information is needed, one can
simply make a class, store extra data as attributes in the class,
and let the compute function be a method in the class.

<h2 id="pp:flask_pool1:cml_file" class="anchor">A command-line and file interface</h2>

<p>
Having defined a pool, it is trivial to get a command-line interface
in the application. Just write

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.UI</span> <span style="color: #008000; font-weight: bold">import</span> set_values_from_command_line
pool <span style="color: #666666">=</span> set_values_from_command_line(pool)
</pre></div>
<p>
Now <code>pool</code> has values loaded from the command line. The name of
the command-line options follow the names in the pool, but with
underscore replacing whitespace: <code>--Initial_motion_data/Initial_angle</code>.
However, in this case just writing <code>--Initial_angle</code> also works since it is a
unique name in the pool tree, and then we do not need the complete
path with the subpool name.

<p>
One can also read data from a file with syntax

<p>

<!-- code=text (!bc dat) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>subpool Initial motion data
  Initial angle = 45.5        # small perturbation
  Spinrate = 20
end
subpool Body and environment data
  Wind velocity = -10  ! m/s  # units appear after ! (before #)
end
</pre></div>
<p>
Data from the file is loaded into the pool by

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.UI</span> <span style="color: #008000; font-weight: bold">import</span> set_defaults_from_file
pool <span style="color: #666666">=</span> set_defaults_from_file(pool)
</pre></div>
<p>
To activate reading from file <code>mydat.dat</code>, one must supply the
command-line arguments <code>--poolfile mydat.dat</code>.

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Tip: autogenerate the file with default data.</b>
The function <code>write_poolfile(pool)</code> in <code>parampool.pool.UI</code>
writes the current pool data to a file with the right syntax.
This is a simple way of getting the complete pool in the file.
</div>


<p>
Often, an application will first load default values from file,
then from the command line, and finally launch the graphical web
interface for enabling interactive setting of values in the pool system.
Automatic generation of such interactive web interfaces constitutes
the next topic. The lines above for loading parameters from file
and command line are automatically generated when a web interface
is requested (see also comments in the section <a href="#pp:flask_pool1:GUI_cml_file">Loading parameters from file and the command line</a>).

<h2 id="pp:flask_pool1:GUI" class="anchor">A web-based user interface</h2>

<p>
With a pool function and a compute function at hand,
it remains to make a new directory, copy the module(s) containing
the pool function and compute function to this directory,
and write a <a href="https://github.com/hplgit/parampool/tree/master/doc/src/pp/src-pp/flask_pool1" target="_self"><tt>generate.py</tt></a> file with the content

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.generator.flask</span> <span style="color: #008000; font-weight: bold">import</span> generate
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute_motion_and_forces_with_pool, \
     pool_definition_list

generate(compute_motion_and_forces_with_pool,
         pool_function<span style="color: #666666">=</span>pool_definition_list,
         MathJax<span style="color: #666666">=</span><span style="color: #008000">True</span>)
</pre></div>
<p>
The <code>generate</code> function will now use the information in the pool
(and not the arguments in the compute function!) to generate
a flexible user interface. Note that an Internet connection
is required. After running

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Terminal&gt; python generate.py
</pre></div>
<p>
several Flask files and directories are generated (<code>model.py</code>, <code>controller.py</code>,
<code>templates</code>, <code>static</code>, and a simple clean-up script <code>clean.sh</code>).
The user interface is started by

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Terminal&gt; python controller.py
</pre></div>
<p>
Open the URL <code>http://127.0.0.1:5000</code> in a web broswer to see an interface
as the one in Figure <a href="#pp:flask_pool1:fig1">7</a>.

<p>
<center> <!-- figure label: --> <div id="pp:flask_pool1:fig1"></div> <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 7:  Web interface in closed form.  <!-- caption label: pp:flask_pool1:fig1 --> </p></center>
<p><img src="fig-pp/flask_pool1_closed.png" align="bottom" width=800></p>
</center>

<h2 id="pp:flask_pool1:GUI_op" class="anchor">Operating the graphical web interface</h2>

<p>
The pool tree is mapped onto a visual structure often used for
directory trees. The look and feel resemble that of the Windows
Explorer application in the Windows operating system.

<p>
Clicking on <em>open all</em> at the top of the user interface
expands all subpools so that all parameters (data items) become visible.
Figure <a href="#pp:flask_pool1:fig2">8</a> displays the result in the Opera browser.
Note that in this type of user interface, the name of each data item
is automatically typeset in LaTeX and inserted as a picture (the
<a href="http://latex.codecogs.com" target="_self"><tt>http://latex.codecogs.com</tt></a> utility is used).

<p>
<center> <!-- figure label: --> <div id="pp:flask_pool1:fig2"></div> <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 8:  Web interface in fully expanded form.  <!-- caption label: pp:flask_pool1:fig2 --> </p></center>
<p><img src="fig-pp/flask_pool1_open.png" align="bottom" width=800></p>
</center>

<p>
The following technical points must be mentioned.

<ol>
<li> A plain float or integer value gives a <code>textline</code> widget,
   while if a <code>minmax</code>
   range is specified, a <code>float</code> or <code>integer</code> widget
   (so-called HTML5 number field) is chosen.</li>
<li> Data items whose widgets are specified as <code>float</code> or <code>integer</code>, or
   where this is implied because <code>str2type</code> is <code>float</code> or <code>int</code>, or
   the default value is a <code>float</code> or <code>int</code> <em>and</em> the <code>minmax</code> attribute
   is assign, are shown using the <a href="http://www.wufoo.com/html5/" target="_self">HTML5 input field</a> called number.
   This is recogned by the small (and not so useful) arrows that can be
   used to adjust the number,
   but usually typing in the number manually is faster and more precise.
   An extra attribute, <code>number_step</code> controls the stepping when clicking
   on the arrows and also the allowed precision of a typed number
   (same as <code>number_step</code>, which by default is 0.001).</li>
<li> When the widget is <code>range</code>, an HTML5 range field is used, which is
   usually rendered as a slider in browsers. The slider gets by default
   100 steps (can be changed or specified individually for any data item).</li>
<li> With the <code>select</code> widget we get a pull-down menu with the different
   options.</li>
<li> Any data item whose default value is <code>True</code> or <code>False</code> maps directly to
   a checkbox for boolean parameters.</li>
<li> Any data item with <code>unit</code> specified maps to an ordinary text field,
   since input consists of a number with an optional text for the unit.
   That is, if we choose to set <code>unit='m/s'</code> for the &quot;Initial velocity&quot;
   data item, the input field will not the an HTML5 number field, but
   a standard HTML text field.</li>
<li> The names of the data items are typeset in LaTeX and shown as
   PNG images. This means that data item names may contain
   mathematical expressions: <code>Spinrate $\omega$</code> for instance.</li>
</ol>

<div class="alert alert-block alert-danger alert-text-normal"><b>Warning.</b>
The HTML5 number field is rendered differently in different browsers.
This can lead to strange layout of the input fields. In such cases
it is recommended to avoid the HTML5 number field. This is easiest
accomplished by explicitly specifying <code>widget</code> to be <code>textline</code>.
This is also the default widget type if you equip the number
with a unit or do not specify any widget, just a float or integer
default value.
</div>


<p>
We can try out the interface:

<ol>
<li> Set &quot;Initial velocity&quot; to 8.</li>
<li> Move the slider for &quot;Initial angle&quot; to 55.</li>
<li> Add a positive &quot;Wind velocity&quot; of -3.</li>
<li> Specify &quot;Mass&quot;as the text <code>0.1*1000 g</code> (i.e., we use g rather
   than the default kg as unit, but the value is still 0.1 kg).</li>
<li> Choose <code>RK2</code> for &quot;Method&quot;.</li>
<li> Set &quot;Time step&quot; to 0.12.</li>
<li> Uncheck the &quot;Plot simplified motion&quot; boolean value.</li>
<li> Hold the mouse pointer over the
   &quot;Wind velocity&quot; field to see the help string. Then point the mouse
   to  &quot;Mass&quot; input field and the specified unit pops up.
   A combination of help
   and unit information is showed if both are given in the
   data item definition.</li>
</ol>

You should see something like Figure <a href="#pp:flask_pool1:fig3">9</a>.

<p>
<center> <!-- figure label: --> <div id="pp:flask_pool1:fig3"></div> <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 9:  Web interface with input parameters filled out.  <!-- caption label: pp:flask_pool1:fig3 --> </p></center>
<p><img src="fig-pp/flask_pool1_filled.png" align="bottom" width=800></p>
</center>

<p>
Now, press the <em>Compute</em> button. Figure <a href="#pp:flask_pool1:fig4">10</a> shows
the resulting response. You can now play around and click the checkbox
for <em>Plot simplified motion</em> and the recompute to see the effects
of wind against the motion, drag, and lift (which are substantial in
this example).

<p>
<center> <!-- figure label: --> <div id="pp:flask_pool1:fig4"></div> <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 10:  Web interface with input and results.  <!-- caption label: pp:flask_pool1:fig4 --> </p></center>
<p><img src="fig-pp/flask_pool1_result.png" align="bottom" width=800></p>
</center>

<h2 id="pp:flask_pool1:GUI_error" class="anchor">Detection of wrong input</h2>

<p>
<b>Text in a number field.</b>
Write <code>abc</code> in the &quot;Initial velocity&quot; field and press the <em>Compute</em> button.
The error message &quot;Please enter a number&quot; pops up.

<p>
<b>Failure of user-provided validate function.</b>
Give a negative value for &quot;Mass&quot;.
The &quot;Mass&quot;data item has a validation function provided by us.
A <code>False</code> value returned from this function gives rise to a
<code>DataItemValueError</code> shown in the browser. It reads here

<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Mass = -0.1: validate function &lt;lambda&gt; claims invalid value.
</pre></div>
<p>
<b>Failure of converting string to right type.</b>
Write <code>abc</code> for &quot;Radius&quot;. This is a text field so any
text is in principle valid, but Parampool raises a <code>TypeError</code>
with the message

<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>could not apply str2type=&lt;type &#39;float&#39;&gt; to value abc &lt;type &#39;str&#39;&gt;
</pre></div>
<p>
<b>Failure in the compute function.</b>
Give a list <code>[0.1, 0.2]</code> for &quot;Time step&quot;. Since the default is <code>None</code>,
which causes <code>str2type=eval</code>, any Python expression is accepted in
the interface, but the compute function used in our example
in this tutorial will raise a <code>TypeError</code>
because <code>float(dt)</code> fails when <code>dt</code> is a list. One could think
of providing a tailored <code>str2type</code> function in this case:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">convert_time_step</span>(value):
    <span style="color: #408080; font-style: italic"># Value must be None or a float</span>
    <span style="color: #008000; font-weight: bold">if</span> value <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;None&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">None</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">try</span>:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">float</span>(value)
        <span style="color: #008000; font-weight: bold">except</span> <span style="color: #D2413A; font-weight: bold">TypeError</span>:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">TypeError</span>(
	    <span style="color: #BA2121">&#39;Time step: could not convert &quot;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&quot; to float, &#39;</span>
	    <span style="color: #BA2121">&#39;must be None or float&#39;</span> <span style="color: #666666">%</span> value)
</pre></div>
<p>
Setting <code>str2type=convert_time_step</code> for the &quot;Time step&quot; data item
gives an informative error message if the answer is not as expected:
<code>None</code> or a floating-point number.

<h2 id="pp:flask_pool1:GUI_cml_file" class="anchor">Loading parameters from file and the command line</h2>

<p>
Parameters can be assigned default values in a file and then other
values on the command line, see the section <a href="#pp:flask_pool1:cml_file">A command-line and file interface</a>,
before the web GUI is offered to the user. When autogenerating the web
interface, the magic lines from the section <a href="#pp:flask_pool1:cml_file">A command-line and file interface</a>
are automatically inserted in the <code>controller.py</code> file (for Flask or
<code>views.py</code> for Django).  This means that when starting <code>python
controller.py</code> we may add <code>--poolfile name</code> and any set of
command-line options for setting individual parameters. This makes it
easy to control which default values that will appear in the web GUI.

<h2 id="___sec27" class="anchor">Common trouble: &quot;Address already in use&quot; </h2>

<p>
Sometimes, after much trial and error with developing a graphical
user interface, one gets an error message that the IP address is
already in use.
To recover from this problem, run the <code>lsof</code> program to see which program
that applies the 5000 port (Flask runs its server on <code>http://127.0.0.1:5000</code>,
which means that it uses the 5000 port). Find the PID of the program
that occupies the port and force abortion of that program:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>Terminal&gt; lsof -i :5000
COMMAND   PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME
python  48824  hpl    3u  IPv4 1128848      0t0  TCP ...
Terminal&gt; kill -9 48824
</pre></div>
<p>
Now you can restart the application.

<h2 id="___sec28" class="anchor">Specifying a pool using an API </h2>

<p>
Instead of listing all the entries in the pool tree as strings, lists,
and dicts in a nested data structure, you can use the
Application Programming Interface (API) of the <code>parampool.pool</code> package.
The pool defined above is alternatively programmed like this using
the API:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">pool_definition_api</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Create and return pool using the parampool.pool API.&quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.Pool</span> <span style="color: #008000; font-weight: bold">import</span> Pool
    pool <span style="color: #666666">=</span> Pool()
    <span style="color: #408080; font-style: italic"># Go to a subpool, but create it if it does not exist</span>
    pool<span style="color: #666666">.</span>subpool(<span style="color: #BA2121">&#39;Main pool&#39;</span>)
    pool<span style="color: #666666">.</span>subpool(<span style="color: #BA2121">&#39;Initial motion data&#39;</span>)
    <span style="color: #408080; font-style: italic"># Define data items for the current subpool</span>
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial velocity&#39;</span>, default<span style="color: #666666">=5.0</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial angle&#39;</span>, default<span style="color: #666666">=45</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;range&#39;</span>, minmax<span style="color: #666666">=</span>[<span style="color: #666666">0</span>,<span style="color: #666666">90</span>])
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Spinrate&#39;</span>, default<span style="color: #666666">=50</span>, widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;1/s&#39;</span>)

    <span style="color: #408080; font-style: italic"># Move to (and create) another subpool, as in a file tree</span>
    pool<span style="color: #666666">.</span>subpool(<span style="color: #BA2121">&#39;../Body and environment data&#39;</span>)
    <span style="color: #408080; font-style: italic"># Add data items for the current subpool</span>
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Wind velocity&#39;</span>, default<span style="color: #666666">=0.0</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Wind velocity in positive x direction.&#39;</span>,
        minmax<span style="color: #666666">=</span>[<span style="color: #666666">-50</span>, <span style="color: #666666">50</span>], number_step<span style="color: #666666">=0.5</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>, str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Mass&#39;</span>, default<span style="color: #666666">=0.1</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;kg&#39;</span>,
        validate<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> data_item, value: value <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Mass of body.&#39;</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Radius&#39;</span>, default<span style="color: #666666">=0.11</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;m&#39;</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Radius of spherical body.&#39;</span>)

    pool<span style="color: #666666">.</span>subpool(<span style="color: #BA2121">&#39;../Numerical parameters&#39;</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Method&#39;</span>, default<span style="color: #666666">=</span><span style="color: #BA2121">&#39;RK4&#39;</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;select&#39;</span>,
        options<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;RK4&#39;</span>, <span style="color: #BA2121">&#39;RK2&#39;</span>, <span style="color: #BA2121">&#39;ForwardEuler&#39;</span>],
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Numerical solution method.&#39;</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Time step&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">None</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;textline&#39;</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;s&#39;</span>, str2type<span style="color: #666666">=</span>convert_time_step)

    pool<span style="color: #666666">.</span>subpool(<span style="color: #BA2121">&#39;../Plot parameters&#39;</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Plot simplified motion&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">True</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Plot motion without drag+lift forces.&#39;</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;New plot&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">True</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Erase all old curves.&#39;</span>)
    pool<span style="color: #666666">.</span>update()
    <span style="color: #008000; font-weight: bold">return</span> pool
</pre></div>
<p>
The API is in many ways easier to use than the nested data structure
with lists, strings, and dicts. The API resembles moving around in
a file tree. The rules are simple:

<ul>
 <li> <code>pool.subpool(path)</code> moves us to a subpool <code>path</code>, and creates
   it first if it does not exist. This is similar to <code>cd path</code>
   in a file tree, or <code>mkdir path; cd path</code>, if <code>path</code> does not
   exist.</li>
 <li> The name of a subpool, <code>path</code>, follows the rule of file and
   directory names in a file tree: a slash is used as delimiter
   between subpools and data items. For example:</li>

<ul>
     <li> <code>/Main pool/Initial motion data/Initial velocity</code> is the
       full path to the &quot;Initial velocity&quot; data item.</li>
     <li> Standing in the &quot;Initial motion data&quot; subpool,
       <code>..</code> is the parent subpool (&quot;Main pool&quot;), while
       <code>../Numerical parameters</code> is the correct path to the
       &quot;Numerical parameters&quot; subpool. That is, we can use
       relative and absolute paths as in a file tree.</li>
</ul>

 <li> A data item is appended to the current subpool by
   calling <code>pool.add_data_item</code>.</li>
</ul>

The look and functionality
of this GUI (found in the <a href="https://github.com/hplgit/parampool/tree/master/doc/src/pp/src-pp/flask_pool2" target="_self"><tt>flask_pool2</tt></a> directory) are
the same as in the previous one (found in the <a href="https://github.com/hplgit/parampool/tree/master/doc/src/pp/src-pp/flask_pool1" target="_self"><tt>flask_pool1</tt></a>
directory).

<h2 id="___sec29" class="anchor">Specifying a pool using an alternative API </h2>

<p>
There is an another way of defining subpools as well: make a function
for defining each subpool.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">pool_definition_api_with_separate_subpools</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    Create and return a pool by calling up other functions</span>
<span style="color: #BA2121; font-style: italic">    for defining the subpools. Also demonstrate customization</span>
<span style="color: #BA2121; font-style: italic">    of pool properties and inserting default values from file</span>
<span style="color: #BA2121; font-style: italic">    or the command line.</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.Pool</span> <span style="color: #008000; font-weight: bold">import</span> Pool
    pool <span style="color: #666666">=</span> Pool()
    pool<span style="color: #666666">.</span>subpool(<span style="color: #BA2121">&#39;Main pool&#39;</span>)
    pool <span style="color: #666666">=</span> motion_pool(pool)
    pool<span style="color: #666666">.</span>change_subpool(<span style="color: #BA2121">&#39;..&#39;</span>)
    pool <span style="color: #666666">=</span> body_and_envir_pool(pool)
    pool<span style="color: #666666">.</span>change_subpool(<span style="color: #BA2121">&#39;..&#39;</span>)
    pool <span style="color: #666666">=</span> numerics_pool(pool)
    pool<span style="color: #666666">.</span>change_subpool(<span style="color: #BA2121">&#39;..&#39;</span>)
    pool <span style="color: #666666">=</span> plot_pool(pool)
    pool<span style="color: #666666">.</span>update()  <span style="color: #408080; font-style: italic"># finalize pool construction</span>

    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.UI</span> <span style="color: #008000; font-weight: bold">import</span> set_data_item_attribute
    <span style="color: #408080; font-style: italic"># Change default values in the web GUI</span>
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.DataItem</span>
    parampool<span style="color: #666666">.</span>pool<span style="color: #666666">.</span>DataItem<span style="color: #666666">.</span>DataItem<span style="color: #666666">.</span>defaults[<span style="color: #BA2121">&#39;minmax&#39;</span>] <span style="color: #666666">=</span> [<span style="color: #666666">0</span>, <span style="color: #666666">100</span>]
    parampool<span style="color: #666666">.</span>pool<span style="color: #666666">.</span>DataItem<span style="color: #666666">.</span>DataItem<span style="color: #666666">.</span>defaults[<span style="color: #BA2121">&#39;range_steps&#39;</span>] <span style="color: #666666">=</span> <span style="color: #666666">500</span>
    <span style="color: #408080; font-style: italic"># Can also change &#39;number_step&#39; for the step in float fields</span>
    <span style="color: #408080; font-style: italic"># and &#39;widget_size&#39; for the width of widgets</span>

    <span style="color: #408080; font-style: italic"># Let all widget sizes be 6, except for Time step</span>
    pool <span style="color: #666666">=</span> set_data_item_attribute(pool, <span style="color: #BA2121">&#39;widget_size&#39;</span>, <span style="color: #666666">6</span>)
    pool<span style="color: #666666">.</span>get(<span style="color: #BA2121">&#39;Time step&#39;</span>)<span style="color: #666666">.</span>data[<span style="color: #BA2121">&#39;widget_size&#39;</span>] <span style="color: #666666">=</span> <span style="color: #666666">4</span>

    <span style="color: #408080; font-style: italic"># Example on editing hardcoded defaults in the model files</span>
    <span style="color: #408080; font-style: italic"># (not necessary, but a possible technique along with</span>
    <span style="color: #408080; font-style: italic"># setting defaults in the pool, in a file, or on the command line)</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.pool.UI</span> <span style="color: #008000; font-weight: bold">import</span> set_defaults_in_model_file
    flask_modelfile <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;model.py&#39;</span>
    django_modelfile <span style="color: #666666">=</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(
        <span style="color: #BA2121">&#39;motion_and_forces_with_pool&#39;</span>, <span style="color: #BA2121">&#39;app&#39;</span>, <span style="color: #BA2121">&#39;models.py&#39;</span>)
    <span style="color: #008000; font-weight: bold">if</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>isfile(flask_modelfile):
        set_defaults_in_model_file(flask_modelfile, pool)
    <span style="color: #008000; font-weight: bold">elif</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>isfile(django_modelfile):
        set_defaults_in_model_file(django_modelfile, pool)

    <span style="color: #008000; font-weight: bold">return</span> pool

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">motion_pool</span>(pool, name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial motion data&#39;</span>):
    pool<span style="color: #666666">.</span>subpool(name)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial velocity&#39;</span>, default<span style="color: #666666">=5.0</span>, symbol<span style="color: #666666">=</span><span style="color: #BA2121">&#39;v_0&#39;</span>,
        unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;m/s&#39;</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial velocity&#39;</span>,
        str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>, widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>,
        validate<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> data_item, value: value <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial angle&#39;</span>, default<span style="color: #666666">=45</span>, symbol<span style="color: #666666">=</span><span style="color: #BA2121">r&#39;\theta&#39;</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;range&#39;</span>, minmax<span style="color: #666666">=</span>[<span style="color: #666666">0</span>,<span style="color: #666666">90</span>], str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Initial angle&#39;</span>,
        validate<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> data_item, value: <span style="color: #666666">0</span> <span style="color: #666666">&lt;</span> value <span style="color: #666666">&lt;=</span> <span style="color: #666666">90</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Spinrate&#39;</span>, default<span style="color: #666666">=50</span>, symbol<span style="color: #666666">=</span><span style="color: #BA2121">r&#39;\omega&#39;</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>, str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;1/s&#39;</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Spinrate&#39;</span>)
    <span style="color: #008000; font-weight: bold">return</span> pool

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">body_and_envir_pool</span>(pool, name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Body and environment data&#39;</span>):
    pool<span style="color: #666666">.</span>subpool(name)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Wind velocity&#39;</span>, default<span style="color: #666666">=0.0</span>, symbol<span style="color: #666666">=</span><span style="color: #BA2121">&#39;w&#39;</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Wind velocity in positive x direction.&#39;</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;m/s&#39;</span>,
        minmax<span style="color: #666666">=</span>[<span style="color: #666666">-50</span>, <span style="color: #666666">50</span>], number_step<span style="color: #666666">=0.5</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>, str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Mass&#39;</span>, default<span style="color: #666666">=0.1</span>, symbol<span style="color: #666666">=</span><span style="color: #BA2121">&#39;m&#39;</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Mass of body.&#39;</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;kg&#39;</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>, str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>,
        validate<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> data_item, value: value <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Radius&#39;</span>, default<span style="color: #666666">=0.11</span>, symbol<span style="color: #666666">=</span><span style="color: #BA2121">&#39;R&#39;</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Radius of spherical body.&#39;</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;m&#39;</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;float&#39;</span>, str2type<span style="color: #666666">=</span><span style="color: #008000">float</span>,
        validate<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> data_item, value: value <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>)
    <span style="color: #008000; font-weight: bold">return</span> pool

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">numerics_pool</span>(pool, name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Numerical parameters&#39;</span>):
    pool<span style="color: #666666">.</span>subpool(name)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Method&#39;</span>, default<span style="color: #666666">=</span><span style="color: #BA2121">&#39;RK4&#39;</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;select&#39;</span>,
        options<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;RK4&#39;</span>, <span style="color: #BA2121">&#39;RK2&#39;</span>, <span style="color: #BA2121">&#39;ForwardEuler&#39;</span>],
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Numerical solution method.&#39;</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Time step&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">None</span>, symbol<span style="color: #666666">=</span><span style="color: #BA2121">r&#39;\Delta t&#39;</span>,
        widget<span style="color: #666666">=</span><span style="color: #BA2121">&#39;textline&#39;</span>, unit<span style="color: #666666">=</span><span style="color: #BA2121">&#39;s&#39;</span>, str2type<span style="color: #666666">=</span><span style="color: #008000">eval</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;None: ca 500 steps, otherwise specify float.&#39;</span>)
    <span style="color: #008000; font-weight: bold">return</span> pool

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">plot_pool</span>(pool, name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Plot parameters&#39;</span>):
    pool<span style="color: #666666">.</span>subpool(name)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Plot simplified motion&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">True</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Plot motion without drag and lift forces.&#39;</span>)
    pool<span style="color: #666666">.</span>add_data_item(
        name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;New plot&#39;</span>, default<span style="color: #666666">=</span><span style="color: #008000">True</span>,
        help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Erase all old curves.&#39;</span>)
    <span style="color: #008000; font-weight: bold">return</span> pool
</pre></div>
<p>
This application, found in the directory
<a href="https://github.com/hplgit/parampool/tree/master/doc/src/pp/src-pp/flask_pool3" target="_self"><tt>flask_pool3</tt></a> (with a corresponding <a href="https://github.com/hplgit/parampool/tree/master/doc/src/pp/src-pp/django_pool3" target="_self">Django counterpart</a>),
will now be used to illustrate three important additional features
of Parampool:

<ol>
<li> documentation of the application is in an external file <code>doc.html</code></li>
<li> the name of a parameter can be a mathematical symbol</li>
<li> parameters can have multiple values for investigating many
   parameter sets at once</li>
</ol>

<h3 id="___sec30" class="anchor">File with documentation of the application </h3>

<p>
We have in the section <a href="._pp003.html#pp:flask4">More input parameters and results</a> seen that the doc string of
the compute function may contain a mathematical description of
the problem with rich typesetting (using DocOnce syntax).
It is also possible to make such a description in a separate
file. Any HTML file will work, and the filename is specified by
the <code>doc</code> argument to <code>generate</code>.

<h3 id="___sec31" class="anchor">LaTeX symbol as parameter name </h3>

<p>
One can add a mathematical
LaTeX symbol for the parameter names (the <code>symbol</code> keyword argument).
This symbol can either be displayed as the parameter's complete name,
or the symbol can be added to the standard name of the parameter.
The choice is set by the <code>latex_name</code> keyword argument in the
<code>generate</code> call in <a href="https://github.com/hplgit/parampool/tree/master/doc/src/pp/src-pp/flask_pool3" target="_self"><tt>generate.py</tt></a>:

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">parampool.generator.flask</span> <span style="color: #008000; font-weight: bold">import</span> generate
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute_motion_and_forces_with_pool_loop, \
     pool_definition_api_with_separate_subpools

generate(compute_motion_and_forces_with_pool_loop,
         pool_function<span style="color: #666666">=</span>pool_definition_api_with_separate_subpools,
         MathJax<span style="color: #666666">=</span><span style="color: #008000">True</span>, doc<span style="color: #666666">=</span><span style="color: #008000">open</span>(<span style="color: #BA2121">&#39;doc.html&#39;</span>, <span style="color: #BA2121">&#39;r&#39;</span>)<span style="color: #666666">.</span>read(),
         latex_name<span style="color: #666666">=</span><span style="color: #BA2121">&#39;symbol&#39;</span>)
</pre></div>
<p>
The values of <code>latex_name</code> can be <code>'symbol'</code>, meaning symbol only, or
<code>'text, symbol'</code>, meaning that the ordinary name is
followed by a comma and the symbol.

<h3 id="___sec32" class="anchor">Multiple input values for parameters </h3>

<p>
We can specify multiple values for parameters whose input fields are
pure text fields. For example, for the wind velocity (\( w \)) parameter
we can assign two values separated by the <code>&</code> character: <code>0 & -8</code>.
Calling <code>pool.get_values('Wind velocity')</code> will then return
a list <code>[0, -8]</code> rather than one number. We can hence easily
make a loop over the multiple values for each parameter where we
use pure text as input. Our compute function looks in this case
like this:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute_motion_and_forces_with_pool_loop</span>(pool):
    html <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>
    initial_angle <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Initial angle&#39;</span>)
    method <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Method&#39;</span>)
    new_plot <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;New plot&#39;</span>)  <span style="color: #408080; font-style: italic"># should be True here</span>
    plot_simplified_motion <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Plot simplified motion&#39;</span>)
    <span style="color: #008000; font-weight: bold">for</span> initial_velocity <span style="color: #AA22FF; font-weight: bold">in</span> pool<span style="color: #666666">.</span>get_values(<span style="color: #BA2121">&#39;Initial velocity&#39;</span>):
        <span style="color: #008000; font-weight: bold">for</span> spinrate <span style="color: #AA22FF; font-weight: bold">in</span> pool<span style="color: #666666">.</span>get_values(<span style="color: #BA2121">&#39;Spinrate&#39;</span>):
            <span style="color: #008000; font-weight: bold">for</span> m <span style="color: #AA22FF; font-weight: bold">in</span> pool<span style="color: #666666">.</span>get_values(<span style="color: #BA2121">&#39;Mass&#39;</span>):
                <span style="color: #008000; font-weight: bold">for</span> R <span style="color: #AA22FF; font-weight: bold">in</span> pool<span style="color: #666666">.</span>get_values(<span style="color: #BA2121">&#39;Radius&#39;</span>):
                    <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> pool<span style="color: #666666">.</span>get_values(<span style="color: #BA2121">&#39;Time step&#39;</span>):
                        <span style="color: #008000; font-weight: bold">for</span> w <span style="color: #AA22FF; font-weight: bold">in</span> pool<span style="color: #666666">.</span>get_values(<span style="color: #BA2121">&#39;Wind velocity&#39;</span>):
                            html <span style="color: #666666">+=</span> compute_motion_and_forces(
                                initial_velocity, initial_angle,
                                spinrate, w, m, R, method, dt,
                                plot_simplified_motion, new_plot)
    <span style="color: #008000; font-weight: bold">return</span> html
</pre></div>
<p>
Note that we accumulate the HTML code returned from the
compute function <code>compute_motion_and_forces</code> that runs the simulation
and returns the results as HTML code. Figure <a href="#pp:flask_pool3:fig1">11</a>
features a mathematical description of the application, LaTeX symbols as parameter names, and two input values for two parameters, leading to \( 2\times 2=4 \) runs,
and hence four lines of plots. The example demonstrates how easy it is to quickly
perform parameter studies by simply 1) writing the compute function with
loops and <code>pool.get_values</code>, 2) separating input values by <code>&</code> in the GUI.

<p>
<center> <!-- figure label: --> <div id="pp:flask_pool3:fig1"></div> <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 11:  Web interface with documentation, LaTeX symbols, and multiple input values.  <!-- caption label: pp:flask_pool3:fig1 --> </p></center>
<p><img src="fig-pp/flask_pool3_results.png" align="bottom" width=800></p>
</center>

<p>
However, writing nested loops for a lot of parameters is unnecessary tedious.
We can use the <code>itertools.product</code> function to compute all possible
combinations and simplify the loop. This function takes a set of
lists or tuples and returns an iterator over all combinations of all
the elements in the lists/tuples. As an example,

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">itertools</span>
<span style="color: #666666">&gt;&gt;&gt;</span> values1 <span style="color: #666666">=</span> [<span style="color: #666666">1</span>, <span style="color: #666666">-1</span>]
<span style="color: #666666">&gt;&gt;&gt;</span> values2 <span style="color: #666666">=</span> [<span style="color: #666666">2</span>, <span style="color: #666666">4</span>, <span style="color: #666666">6</span>]
<span style="color: #666666">&gt;&gt;&gt;</span> combinations <span style="color: #666666">=</span> itertools<span style="color: #666666">.</span>product(values1, values2)
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">for</span> combination <span style="color: #AA22FF; font-weight: bold">in</span> combinations:
<span style="color: #666666">...</span>     <span style="color: #008000; font-weight: bold">print</span> combination
(<span style="color: #666666">1</span>, <span style="color: #666666">2</span>)
(<span style="color: #666666">1</span>, <span style="color: #666666">4</span>)
(<span style="color: #666666">1</span>, <span style="color: #666666">6</span>)
(<span style="color: #666666">-1</span>, <span style="color: #666666">2</span>)
(<span style="color: #666666">-1</span>, <span style="color: #666666">4</span>)
(<span style="color: #666666">-1</span>, <span style="color: #666666">6</span>)
</pre></div>
<p>
The single loop is equivalent to

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">for</span> value1 <span style="color: #AA22FF; font-weight: bold">in</span> values1:
    <span style="color: #008000; font-weight: bold">for</span> value2 <span style="color: #AA22FF; font-weight: bold">in</span> values2:
        combination <span style="color: #666666">=</span> (value1, value2)
	<span style="color: #008000; font-weight: bold">print</span> combination
</pre></div>
<p>
With an unknown number of lists as arguments to <code>itertools.prodct</code> one
can use the construction

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>values <span style="color: #666666">=</span> [values1, values2]
combinations <span style="color: #666666">=</span> itertools<span style="color: #666666">.</span>product(<span style="color: #666666">*</span>values)
</pre></div>
<p>
With these ideas we can generalize our implementation of nested loops
over multiple values of the parameters:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute_motion_and_forces_with_pool_loop_product</span>(pool):
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">itertools</span>
    initial_angle <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Initial angle&#39;</span>)
    method <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Method&#39;</span>)
    new_plot <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;New plot&#39;</span>)  <span style="color: #408080; font-style: italic"># should be True here</span>
    plot_simplified_motion <span style="color: #666666">=</span> pool<span style="color: #666666">.</span>get_value(<span style="color: #BA2121">&#39;Plot simplified motion&#39;</span>)
    <span style="color: #408080; font-style: italic"># Make list of all names with potentially multiple values</span>
    names <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;&quot;</span>
<span style="color: #BA2121">    Initial velocity</span>
<span style="color: #BA2121">    Spinrate</span>
<span style="color: #BA2121">    Mass</span>
<span style="color: #BA2121">    Radius</span>
<span style="color: #BA2121">    Time step</span>
<span style="color: #BA2121">    Wind velocity</span>
<span style="color: #BA2121">    &quot;&quot;&quot;</span>
    names <span style="color: #666666">=</span> [line<span style="color: #666666">.</span>strip() <span style="color: #008000; font-weight: bold">for</span> line <span style="color: #AA22FF; font-weight: bold">in</span> names<span style="color: #666666">.</span>splitlines()]
    <span style="color: #408080; font-style: italic"># Get all values of all parameters</span>
    values <span style="color: #666666">=</span> [pool<span style="color: #666666">.</span>get_values(name) <span style="color: #008000; font-weight: bold">for</span> name <span style="color: #AA22FF; font-weight: bold">in</span> names]
    combinations <span style="color: #666666">=</span> itertools<span style="color: #666666">.</span>product(<span style="color: #666666">*</span>values)
    html <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>
    <span style="color: #008000; font-weight: bold">for</span> combination <span style="color: #AA22FF; font-weight: bold">in</span> combinations:
        initial_velocity, spinrate, m, R, dt, w <span style="color: #666666">=</span> combination
        html <span style="color: #666666">+=</span> compute_motion_and_forces(
            initial_velocity, initial_angle,
            spinrate, w, m, R, method, dt,
            plot_simplified_motion, new_plot)
    <span style="color: #008000; font-weight: bold">return</span> html
</pre></div>
<p>
This is the type of implementation recommended in applications.

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pagination">
<li><a href="._pp003.html">&laquo;</a></li>
  <li><a href="._pp000.html">1</a></li>
  <li><a href="._pp001.html">2</a></li>
  <li><a href="._pp002.html">3</a></li>
  <li><a href="._pp003.html">4</a></li>
  <li class="active"><a href="._pp004.html">5</a></li>
  <li><a href="._pp005.html">6</a></li>
  <li><a href="._pp006.html">7</a></li>
  <li><a href="._pp005.html">&raquo;</a></li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

